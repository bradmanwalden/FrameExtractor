# Drone Photogrammetry Frame Extractor

Developed by [Bradley Walden](https://bradleywalden.site)

## Purpose
This python tool is intended to extract every nth frame from a video file, and embed the GPS into the metadata. This is useful for drone photogrammetry projects where you want to extract every nth frame from a video file to use as input for a photogrammetry software.

## Requirements
* Python 3.6+
* ffmpeg
    * Either installed on your system, or in the same directory as the script

## Usage
Simply run the script and follow the prompts. Here are the prompts and some explanations:

* **Video File**: The video file you want to extract frames from. This can be `.mp4 .avi .mov .mkv .flv .wmv .webm .m4v .mpg`
* **SRT File**: The SRT file that contains the GPS data. This is the file that is generated by the drone, alongside the video file. It usually will have the same name as the video file, but with an `.srt` extension.
* **Output Directory**: The directory you want to save the extracted frames to.

* **Name Prefix**: The prefix you want to give the extracted frames. This is useful if you want to extract frames from multiple videos, and you want to keep them separate. For example, if you have a video file called `video1.mp4`, and you want to extract frames from it, you could set the prefix to `video1`. This will name the extracted frames `video1_0001.jpg`, `video1_0002.jpg`, etc.
* **Frame Interval**: The interval at which you want to extract frames. For example, if you want to extract every 10th frame, you would set this to `10`. If you want to extract every frame, you would set this to `1`. With a 30fps video, a value of `30` would extract 1 frame per second.
* **Altitude Mode**: The altitude mode you want to use. This is useful if you want to use the altitude from the SRT file. However there are 2 options. The drone records the absolute altitude, which is the altitude above sea level. However, the drone also records the relative altitude, which is the altitude above the takeoff point. If you want to use the absolute altitude, you would set this to `Absolute`. If you want to use the relative altitude, you would set this to `Relative`. Sometimes, this is inaccurate, so you can also set this to `None`, which will not embed the altitude into the metadata.

## Installation

1. Install Python, at least version 3.6
2. Install ffmpeg
    - On Windows, you can download it from [here](https://ffmpeg.org/download.html), then in the "Get packages and executable files" section
    - Ensure that ffmpeg is in your PATH or in the same directory as the script
3. Download the script & the requirements file
4. Install the requirements
    - `pip install -r requirements.txt`
5. Run the script

## Included Files
* `extract_frames.py`
    * The main script. This is the file you want to run.

* `requirements.txt`
    * The requirements file. This is used to install the required python packages.

* `LICENSE`
    * The license file. This is the GNU GPLv3 license.

* `README.md`
    * This file.

* `examples/`
    * `img.JPG`
        * An example image that was taken from the drone directly. This was used as a reference, for what the photogrammetry software expects as input.
    * `vid1.MP4`
        * An example video file. This was taken from a drone and corresponds to the `vid1.SRT` file.
    * `vid1.SRT`
        * An example SRT file, containing metadata, including GPS data. This was taken from a drone and corresponds to the `vid1.MP4` file.


## Help/Troubleshooting

* If you get an error saying `ffmpeg not found`, ensure that ffmpeg is in your PATH or in the same directory as the script
* If you get errors that look like this, it means there are negative altitude values in the SRT file. This is usually caused by the drone not being able to get a GPS lock. You can either remove the negative values from the SRT file, or set the altitude mode to `None` or `Relative`, as relative values will always be positive.
```
+--------+--------+-------+--------+
| Offset | Value  | Bytes | Format |
+--------+--------+-------+--------+
|        | -57147 |       | uint32 |
+--------+--------+-------+--------+

OverflowError occurred during pack operation:

can't convert negative int to unsigned
```


## License
This project is licensed under GNU GPLv3 - see the [LICENSE](LICENSE) file for details